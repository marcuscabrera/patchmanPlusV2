{% extends "base.html" %}

{% load common %}

{% block page_title %}Patchman Dashboard{% endblock %}

{% block content_title %} Patch Management Dashboard for {{ site.name }} {% endblock %}

{% block content %}
<div class="container-fluid px-0">
  <div class="row g-3 mb-4">
    <div class="col-12 col-sm-6 col-xl-3">
      <div class="card h-100 shadow-sm">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center">
            <span class="text-muted text-uppercase small">Atualiza√ß√µes cr√≠ticas</span>
            <span class="badge bg-danger rounded-pill">{{ secupdate_hosts.count }}</span>
          </div>
          <h2 class="display-6 fw-semibold mt-3 mb-2">{{ secupdate_hosts.count }}</h2>
          <p class="text-secondary mb-0 small">Hosts com atualiza√ß√µes de seguran√ßa pendentes.</p>
        </div>
      </div>
    </div>
    <div class="col-12 col-sm-6 col-xl-3">
      <div class="card h-100 shadow-sm">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center">
            <span class="text-muted text-uppercase small">Atualiza√ß√µes de bugfix</span>
            <span class="badge bg-info text-dark rounded-pill">{{ bugupdate_hosts.count }}</span>
          </div>
          <h2 class="display-6 fw-semibold mt-3 mb-2">{{ bugupdate_hosts.count }}</h2>
          <p class="text-secondary mb-0 small">Hosts aguardando corre√ß√µes n√£o cr√≠ticas.</p>
        </div>
      </div>
    </div>
    <div class="col-12 col-sm-6 col-xl-3">
      <div class="card h-100 shadow-sm">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center">
            <span class="text-muted text-uppercase small">Hosts inativos</span>
            <span class="badge bg-warning text-dark rounded-pill">{{ stale_hosts.count }}</span>
          </div>
          <h2 class="display-6 fw-semibold mt-3 mb-2">{{ stale_hosts.count }}</h2>
          <p class="text-secondary mb-0 small">Hosts sem reportar desde {% reports_timedelta %}.</p>
        </div>
      </div>
    </div>
    <div class="col-12 col-sm-6 col-xl-3">
      <div class="card h-100 shadow-sm">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center">
            <span class="text-muted text-uppercase small">Rein√≠cio pendente</span>
            <span class="badge bg-secondary rounded-pill">{{ reboot_hosts.count }}</span>
          </div>
          <h2 class="display-6 fw-semibold mt-3 mb-2">{{ reboot_hosts.count }}</h2>
          <p class="text-secondary mb-0 small">Hosts que requerem reboot ap√≥s atualiza√ß√µes.</p>
        </div>
      </div>
    </div>
  </div>

  <div class="accordion" id="statusAccordion">
    {% with count=noosrelease_osvariants.count %}
      {% if count > 0 %}
        {% include "includes/status_section.html" with accordion_id="statusAccordion" section_id="noosrelease_osvariants" count=count title="OS variants sem release vinculado" variant="warning" icon="üß©" table_data=noosrelease_osvariants %}
      {% endif %}
    {% endwith %}

    {% with count=nohost_osvariants.count %}
      {% if count > 0 %}
        {% include "includes/status_section.html" with accordion_id="statusAccordion" section_id="nohost_osvariants" count=count title="OS variants sem hosts" variant="info" icon="üñ•Ô∏è" table_data=nohost_osvariants %}
      {% endif %}
    {% endwith %}

    {% with count=norepo_osreleases.count %}
      {% if count > 0 and norepo_osreleases %}
        {% include "includes/status_section.html" with accordion_id="statusAccordion" section_id="norepo_osreleases" count=count title="OS releases sem reposit√≥rio" variant="warning" icon="üóÇÔ∏è" table_data=norepo_osreleases %}
      {% endif %}
    {% endwith %}

    {% with count=stale_hosts.count %}
      {% if count > 0 %}
        {% include "includes/status_section.html" with accordion_id="statusAccordion" section_id="stale_hosts" count=count title="Hosts sem relat√≥rio recente" variant="warning" icon="‚è±Ô∏è" table_data=stale_hosts %}
      {% endif %}
    {% endwith %}

    {% with count=reboot_hosts.count %}
      {% if count > 0 %}
        {% include "includes/status_section.html" with accordion_id="statusAccordion" section_id="reboot_hosts" count=count title="Hosts aguardando reboot" variant="secondary" icon="üîÅ" table_data=reboot_hosts %}
      {% endif %}
    {% endwith %}

    {% with count=secupdate_hosts.count %}
      {% if count > 0 %}
        {% include "includes/status_section.html" with accordion_id="statusAccordion" section_id="secupdate_hosts" count=count title="Hosts com updates de seguran√ßa" variant="danger" icon="üõ°Ô∏è" table_data=secupdate_hosts %}
      {% endif %}
    {% endwith %}

    {% with count=bugupdate_hosts.count %}
      {% if count > 0 %}
        {% include "includes/status_section.html" with accordion_id="statusAccordion" section_id="bugupdate_hosts" count=count title="Hosts com updates de bugfix" variant="info" icon="üß™" table_data=bugupdate_hosts %}
      {% endif %}
    {% endwith %}

    {% with count=norepo_hosts.count %}
      {% if count > 0 %}
        {% include "includes/status_section.html" with accordion_id="statusAccordion" section_id="norepo_hosts" count=count title="Hosts sem reposit√≥rio associado" variant="secondary" icon="üì¶" table_data=norepo_hosts %}
      {% endif %}
    {% endwith %}

    {% with count=diff_rdns_hosts.count %}
      {% if count > 0 %}
        {% include "includes/status_section.html" with accordion_id="statusAccordion" section_id="diff_rdns_hosts" count=count title="Hosts com rDNS divergente" variant="info" icon="üåê" table_data=diff_rdns_hosts %}
      {% endif %}
    {% endwith %}

    {% with count=failed_mirrors.count %}
      {% if count > 0 %}
        {% include "includes/status_section.html" with accordion_id="statusAccordion" section_id="failed_mirrors" count=count title="Reposit√≥rios com mirrors falhos" variant="danger" icon="üö®" table_data=failed_mirrors %}
      {% endif %}
    {% endwith %}

    {% with count=disabled_mirrors.count %}
      {% if count > 0 %}
        {% include "includes/status_section.html" with accordion_id="statusAccordion" section_id="disabled_mirrors" count=count title="Reposit√≥rios com mirrors desativados" variant="secondary" icon="‚õî" table_data=disabled_mirrors %}
      {% endif %}
    {% endwith %}

    {% with count=norefresh_mirrors.count %}
      {% if count > 0 %}
        {% include "includes/status_section.html" with accordion_id="statusAccordion" section_id="norefresh_mirrors" count=count title="Mirrors sem atualiza√ß√£o autom√°tica" variant="warning" icon="üîÅ" table_data=norefresh_mirrors %}
      {% endif %}
    {% endwith %}

    {% with count=failed_repos.count %}
      {% if count > 0 %}
        {% include "includes/status_section.html" with accordion_id="statusAccordion" section_id="failed_repos" count=count title="Reposit√≥rios indispon√≠veis" variant="danger" icon="‚ùå" table_data=failed_repos %}
      {% endif %}
    {% endwith %}

    {% with count=unused_repos.count %}
      {% if count > 0 %}
        {% include "includes/status_section.html" with accordion_id="statusAccordion" section_id="unused_repos" count=count title="Reposit√≥rios sem uso" variant="secondary" icon="üìÅ" table_data=unused_repos %}
      {% endif %}
    {% endwith %}

    {% with count=nomirror_repos.count %}
      {% if count > 0 %}
        {% include "includes/status_section.html" with accordion_id="statusAccordion" section_id="nomirror_repos" count=count title="Reposit√≥rios sem mirrors" variant="warning" icon="ü™û" table_data=nomirror_repos %}
      {% endif %}
    {% endwith %}

    {% with count=nohost_repos.count %}
      {% if count > 0 %}
        {% include "includes/status_section.html" with accordion_id="statusAccordion" section_id="nohost_repos" count=count title="Reposit√≥rios n√£o atribu√≠dos" variant="info" icon="üß≠" table_data=nohost_repos %}
      {% endif %}
    {% endwith %}

    {% with count=possible_mirrors|length %}
      {% if count > 0 %}
        {% include "includes/status_section.html" with accordion_id="statusAccordion" section_id="possible_mirrors" count=count title="Mirrors com checksum compat√≠vel" variant="info" icon="üîó" mirror_checksums=possible_mirrors %}
      {% endif %}
    {% endwith %}

    {% with count=norepo_packages.count %}
      {% if count > 0 %}
        {% include "includes/status_section.html" with accordion_id="statusAccordion" section_id="norepo_packages" count=count title="Pacotes fora de reposit√≥rios" variant="warning" icon="üì¶" packages=norepo_packages %}
      {% endif %}
    {% endwith %}

    {% with count=orphaned_packages.count %}
      {% if count > 0 %}
        {% include "includes/status_section.html" with accordion_id="statusAccordion" section_id="orphaned_packages" count=count title="Pacotes √≥rf√£os" variant="secondary" icon="üóëÔ∏è" packages=orphaned_packages %}
      {% endif %}
    {% endwith %}

    {% with count=unprocessed_reports.count %}
      {% if count > 0 %}
        {% include "includes/status_section.html" with accordion_id="statusAccordion" section_id="unprocessed_reports" count=count title="Relat√≥rios pendentes" variant="warning" icon="üìù" table_data=unprocessed_reports %}
      {% endif %}
    {% endwith %}
  </div>
</div>
{% endblock %}
